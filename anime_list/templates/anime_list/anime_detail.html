{% extends 'base.html' %}
{% load static %}

{% block title %}{{ anime.title }} - –î–µ—Ç–∞–ª—ñ{% endblock %}

{% block content %}
<div class="container mt-4 anime-detail-container">
    <div class="row">
        <!-- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–Ω—ñ–º–µ -->
        <div class="col-md-4 text-center">
            {% if anime.image %}
                <img src="{{ anime.image.url }}" class="anime-detail-img img-fluid rounded shadow-lg" alt="{{ anime.title }}">
            {% else %}
                <img src="{% static 'images/default-anime.jpg' %}" class="anime-detail-img img-fluid rounded shadow-lg" alt="No image">
            {% endif %}
        </div>

        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–Ω—ñ–º–µ -->
        <div class="col-md-8">
            <h1 class="anime-title">{{ anime.title }}</h1>
            <p class="text-muted"><i class="fas fa-calendar-alt"></i> <strong>–†—ñ–∫ –≤–∏–ø—É—Å–∫—É:</strong> {{ anime.release_year|default:"–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö" }}</p>
            
            <p><i class="fas fa-layer-group"></i> <strong>–ñ–∞–Ω—Ä–∏:</strong> 
                {% for category in anime.categories.all %}
                    <span class="badge bg-primary">{{ category.name }}</span>
                {% empty %}
                    <span class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</span>
                {% endfor %}
            </p>

            <p><i class="fas fa-film"></i> <strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ—Ä—ñ–π:</strong> {{ anime.number_of_series|default:"–ù–µ –≤–∫–∞–∑–∞–Ω–æ" }}</p>
            
            <p><i class="fas fa-info-circle"></i> <strong>–û–ø–∏—Å:</strong> 
                <span class="anime-description">{{ anime.description|default:"–ù–µ–º–∞—î –æ–ø–∏—Å—É" }}</span>
            </p>

            <p><i class="fas fa-star"></i> <strong>–°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥:</strong> 
                {% if average_rating %}
                    <span class="badge bg-warning text-dark">{{ average_rating|floatformat:2 }} ‚≠ê</span>
                {% else %}
                    <span class="text-muted">–û—Ü—ñ–Ω–æ–∫ —â–µ –Ω–µ–º–∞—î</span>
                {% endif %}
            </p>

            <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ (–∑—ñ—Ä–æ—á–∫–∏) -->
            {% if user.is_authenticated %}
                <form method="post" id="ratingForm">
                    {% csrf_token %}
                    <div class="star-rating">
                        <input type="radio" name="score" value="10" id="star10"><label for="star10">‚òÖ</label>
                        <input type="radio" name="score" value="9" id="star9"><label for="star9">‚òÖ</label>
                        <input type="radio" name="score" value="8" id="star8"><label for="star8">‚òÖ</label>
                        <input type="radio" name="score" value="7" id="star7"><label for="star7">‚òÖ</label>
                        <input type="radio" name="score" value="6" id="star6"><label for="star6">‚òÖ</label>
                        <input type="radio" name="score" value="5" id="star5"><label for="star5">‚òÖ</label>
                        <input type="radio" name="score" value="4" id="star4"><label for="star4">‚òÖ</label>
                        <input type="radio" name="score" value="3" id="star3"><label for="star3">‚òÖ</label>
                        <input type="radio" name="score" value="2" id="star2"><label for="star2">‚òÖ</label>
                        <input type="radio" name="score" value="1" id="star1"><label for="star1">‚òÖ</label>
                    </div>
                    <!-- <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É</button> -->
                </form>
            {% else %}
                <p class="text-muted"><a href="{% url 'login' %}">üîë –£–≤—ñ–π–¥—ñ—Ç—å</a>, —â–æ–± –æ—Ü—ñ–Ω–∏—Ç–∏ –∞–Ω—ñ–º–µ.</p>
            {% endif %}

            <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤ —É–ª—é–±–ª–µ–Ω–µ -->
            {% if user.is_authenticated %}
                <form action="{% url 'toggle_favorite' anime.id %}" method="post" class="favorite-form mt-3">
                    {% csrf_token %}
                    <button type="submit" class="btn {% if anime in user.favoriteanime_set.all %}btn-danger{% else %}btn-warning{% endif %}">
                        {% if anime in user.favoriteanime_set.all %}
                            ‚ùå –í–∏–¥–∞–ª–∏—Ç–∏ –∑ —É–ª—é–±–ª–µ–Ω–∏—Ö
                        {% else %}
                            ‚ù§Ô∏è –î–æ–¥–∞—Ç–∏ –≤ —É–ª—é–±–ª–µ–Ω–µ
                        {% endif %}
                    </button>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è -->
    <div class="text-center mt-4">
        <a href="{% url 'anime_list' %}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</a>
    </div>
</div>

<!-- JavaScript –¥–ª—è –∑—ñ—Ä–∫–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥—É -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const stars = document.querySelectorAll('.star-rating input');
        stars.forEach(star => {
            star.addEventListener('change', function() {
                document.getElementById("ratingForm").submit();
            });
        });
    });
</script>
{% endblock %}
